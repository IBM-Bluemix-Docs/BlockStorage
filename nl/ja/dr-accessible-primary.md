---

copyright:
  years: 2015, 2018
lastupdated: "2018-12-10"

---
{:new_window: target="_blank"}
{:tip: .tip}
{:note: .note}
{:important: .important}
{:DomainName: data-hd-keyref="APPDomain"}
{:DomainName: data-hd-keyref="DomainName"}

# 災害復旧 - アクセス可能 1 次ボリュームを使用したフェイルオーバー

1 次サイトで壊滅的な障害や災害が発生したものの、まだ 1 次ストレージにアクセス可能な場合は、以下の操作を実行して、2 次サイトのデータに速やかにアクセスできます。

フェイルオーバーを開始する前に、すべてのホスト許可が所定の場所に設定されていることを確認してください。

許可されたホストとボリュームは、同じデータ・センター内に存在する必要があります。 例えば、レプリカ・ボリュームをロンドンに置き、ホストをアムステルダムに置くことはできません。両方がロンドンに存在するか、両方がアムステルダムに存在する必要があります。
{:note}

1. [{{site.data.keyword.cloud}} コンソール ![External link icon](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://{DomainName}/catalog/){:new_window} にログインし、左上の**「メニュー」**アイコンをクリックします。 **「クラシック・インフラストラクチャー」**を選択します。


   または、[{{site.data.keyword.slportal}} ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://control.softlayer.com/){:new_window} にログインできます。
2. ソース・ボリュームまたは宛先ボリュームを、**「{{site.data.keyword.blockstorageshort}}」**ページでクリックします。
3. **「レプリカ」**をクリックします。
4. **「ホストの許可」**フレームまでスクロールダウンして、右にある**「ホストの許可」**をクリックします。
5. レプリケーション用に許可するホストを強調表示します。 複数のホストを選択するには、Ctrl キーを使用して該当するホストをクリックします。
6. **「送信」**をクリックします。 使用可能なホストがない場合は、同じデータ・センターでコンピュート・リソースを購入するよう求めるプロンプトが出されます。


## ボリュームからそのレプリカへのフェイルオーバーの開始

障害が発生するおそれがある場合、宛先 (つまりターゲット) ボリュームへの**フェイルオーバー**を開始できます。 ターゲット・ボリュームがアクティブになります。 最後に正常に複製されたスナップショットがアクティブになり、ボリュームがマウント可能になります。 前回のレプリケーション・サイクル以降にソース・ボリュームに書き込まれたデータは、すべて失われます。 フェイルオーバーが開始されると、レプリケーションの関係が反転します。 ターゲット・ボリュームがソース・ボリュームになり、以前のソース・ボリュームは、**「LUN 名」**の後に **REP** を付けて示されるターゲットになります。

フェイルオーバーは、[{{site.data.keyword.slportal}} ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://control.softlayer.com/){:new_window} の**「ストレージ」**、**「{{site.data.keyword.blockstorageshort}}」**の下で開始されます。

**これらのステップに進む前に、ボリュームを切り離します。 そうしないと、破損やデータ損失が発生します。**

1. アクティブな LUN (「ソース」) をクリックします。
2. **「レプリカ」**をクリックし、**「アクション」**をクリックします。
3. **「フェイルオーバー」**を選択します。

   ページにフェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.blockstorageshort}}** 上のボリュームの横に、アクティブなトランザクションが発生していることを示すアイコンが表示されます。 アイコンの上にカーソルを移動すると、トランザクションを示すウィンドウが生成されます。 アイコンは、トランザクションが完了すると表示されなくなります。 フェイルオーバー・プロセス中、構成に関連したアクションは読み取り専用になります。 スナップショット・スケジュールを編集したり、スナップショット・スペースを変更したりすることはできません。 このイベントは、レプリケーション履歴にログとして記録されます。<br/> ターゲット・ボリュームが稼働している場合は、別のメッセージが表示されます。 元のソース・ボリュームの LUN 名が「REP」で終わるように更新され、その状況の表示が「非アクティブ」になります。
   {:note}
4. **「すべて表示 ({{site.data.keyword.blockstorageshort}})」**をクリックします。
5. アクティブな LUN (以前のターゲット・ボリューム) をクリックします。
6. ストレージ・ボリュームをホストにマウントして、接続します。 手順については、[ここ](provisioning-block_storage.html)をクリックしてください。


## ボリュームからそのレプリカへのフェイルバックの開始

元のソース・ボリュームが修復されたら、元のソース・ボリュームへの制御されたフェイルバックを開始できます。 制御付きフェイルバックでは、

- 作動中のソース・ボリュームがオフラインにされ、
- スナップショットが取得され、
- レプリケーション・サイクルが完了し、
- 作成されたばかりのデータ・スナップショットがアクティブ化され、
- ソース・ボリュームがマウント用にアクティブになります。

フェイルバックが開始されると、レプリケーションの関係が再び反転します。 ソース・ボリュームがソース・ボリュームとして復元され、ターゲット・ボリュームは、再度、**「LUN 名」**の後に **REP** を付けて示されるターゲット・ボリュームになります。

フェイルオーバーは、[{{site.data.keyword.slportal}} ![外部リンク・アイコン](../../icons/launch-glyph.svg "外部リンク・アイコン")](https://control.softlayer.com/){:new_window} の**「ストレージ」**、**「{{site.data.keyword.blockstorageshort}}」**の下で開始されます。

1. アクティブな LUN (「ターゲット」) をクリックします。
2. 右上にある**「レプリカ」**をクリックし、**「アクション」** をクリックします。
3. **「フェイルバック」**を選択します。

   ページにフェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.blockstorageshort}}** 上のボリュームの横に、アクティブなトランザクションが発生していることを示すアイコンが表示されます。 アイコンの上にカーソルを移動すると、トランザクションを示すウィンドウが生成されます。 アイコンは、トランザクションが完了すると表示されなくなります。 フェイルバック・プロセス中、構成に関連したアクションは読み取り専用になります。 スナップショット・スケジュールを編集したり、スナップショット・スペースを変更したりすることはできません。 このイベントは、レプリケーション履歴に記録されます。
   {:note}
4. 右上で、**「すべて表示 {{site.data.keyword.blockstorageshort}}」**リンクをクリックします。
5. アクティブな LUN (「ソース」) をクリックします。
6. ストレージ・ボリュームをホストにマウントして、接続します。 手順については、[ここ](provisioning-block_storage.html)をクリックしてください。
