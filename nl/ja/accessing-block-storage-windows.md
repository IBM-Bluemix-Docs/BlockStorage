---

copyright:
  years: 2014, 2018
lastupdated: "2018-05-16"

---
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}

# Microsoft Windows での MPIO iSCSI LUN への接続

開始する前に、{{site.data.keyword.blockstoragefull}} ボリュームにアクセスするホストが、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window} を介して許可されていることを確認してください。

1. {{site.data.keyword.blockstorageshort}} リスト・ページで、新規ボリュームに関連付けられている**「アクション」**をクリックし、**「ホストを許可」**をクリックします。
2. リストから、ボリュームにアクセスする必要があるホストを選択し、**「送信」**をクリックします。

## {{site.data.keyword.blockstorageshort}} ボリュームのマウント方法

以下に、Windows ベースの {{site.data.keyword.BluSoftlayer_full}} コンピューティング・インスタンスをマルチパス入出力 (MPIO) Internet Small Computer System Interface (iSCSI) 論理装置番号 (LUN) に接続するために必要なステップを示します。 この例は、Windows Server 2012 に基づいています。 その他の Windows バージョンの場合、オペレーティング・システム (OS) のベンダーの資料に従って、ステップを調整してください。

### MPIO 機能の構成

1. 「サーバー マネージャ」を開始し、**「管理」**、**「役割と機能の追加」**にナビゲートします。
2. **「次へ」**をクリックし、「機能」メニューに進みます。
3. スクロールダウンし、**「マルチパス I/O」**にチェック・マークを付けます。
4. **「インストール」**をクリックして、MPIO をホスト・サーバーにインストールします。
![「サーバー マネージャ」での「役割と機能の追加」](/images/Roles_Features.png)

### MPIO の iSCSI サポートの追加

1. **「スタート」**をクリックし、**「管理ツール」**を指し、**「MPIO」**をクリックして、MPIO プロパティーを開きます。
2. **「マルチパスの検出」**をクリックします。
3. **「iSCSI デバイスのサポートを追加する」**にチェック・マークを付け、**「追加」**をクリックします。コンピューターの再始動を求めるプロンプトが出されたら、**「はい」**をクリックします。

**注**: Windows Server 2008 の場合、iSCSI のサポートを追加すると、Microsoft Device Specific Module (MSDSM) が MPIO 対応のすべての iSCSI デバイスを要求できるようになります。しかし、そのためには、最初に iSCSI ターゲットへの接続が必要になります。

### iSCSI イニシエーターの構成

1. 「サーバー マネージャ」から iSCSI イニシエーターを起動し、**「ツール」**、**「iSCSI イニシエーター」**を選択します。
2. **「構成」**タブをクリックをします。
    - 「イニシエーター名」フィールドには、iqn.1991-05.com.microsoft: のような項目が既に取り込まれている場合があります。
    - **「変更」** をクリックして、既存の値をご使用の iSCSI 修飾名 (IQN) に置き換えます。 IQN 名は、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}の「{{site.data.keyword.blockstorageshort}} 詳細」画面で取得できます。
    ![iSCSI イニシエーターのプロパティー](/images/iSCSI.png)
    - **「探索」**タブをクリックし、**「ポータルの探索」**をクリックします。
    - iSCSI ターゲットの IP アドレスを入力し、ポートはデフォルト値の 3260 のままにします。 
    - **「詳細設定」**をクリックして、「詳細設定」ウィンドウを開きます。
    - **「CHAP ログオンを有効にする」**を選択して、CHAP 認証をオンにします。
    ![CHAP ログオンを有効にする](/images/Advanced_0.png)
    **注:** 「名前」フィールドと「ターゲット シークレット」フィールドでは、大/小文字が区別されます。
         - **「名前」**フィールドで、既存のエントリーをすべて削除し、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から取得したユーザー名を入力します。
         - **「ターゲット シークレット」**フィールドに、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から取得したパスワードを入力します。
    - **「詳細設定」**ウィンドウおよび**「ターゲット ポータルの探索」**ウィンドウで**「OK」**をクリックして、メインの「iSCSI イニシエーターのプロパティ」画面に戻ります。認証エラーを受け取った場合は、ユーザー名とパスワードの項目を再確認してください。
    ![非アクティブ・ターゲット](/images/Inactive_0.png)
    ターゲットの名前は、「検出されたターゲット」セクションに非アクティブ状態と表示されます。 

    
### ターゲットのアクティブ化

1. **「接続」**をクリックして、ターゲットに接続します。
2. **「複数パスを有効にする」**チェック・ボックスを選択して、ターゲットへのマルチパス IO を有効にします。
![複数パスを有効にする](/images/Connect_0.png)
3. **「詳細設定」**をクリックし、**「CHAP ログオンを有効にする」**を選択します。
![CHAP ログオンを有効にする](/images/chap_0.png)
4. 「名前」フィールドにユーザー名を入力し、「ターゲット シークレット」フィールドにパスワードを入力します。<br/>
**注:** 「名前」および「ターゲット シークレット」フィールドの値は、「{{site.data.keyword.blockstorageshort}} 詳細」画面から取得できます。
5. **「iSCSI イニシエーターのプロパティ」**ウィンドウが表示されるまで**「OK」**をクリックします。 **「検出されたターゲット」**セクションのターゲットの状況が、**「非アクティブ」**から**「接続完了」**に変わります。
![「接続完了」状況](/images/Connected.png) 


### iSCSI イニシエーターでの MPIO の構成

1. iSCSI イニシエーターを起動し、「ターゲット」タブで**「プロパティ」**をクリックします。
2. 「プロパティ」ウィンドウで**「セッションの追加」**をクリックして、「ターゲットへの接続」ウィンドウを立ち上げます。
3. **「複数パスを有効にする」**チェック・ボックスを選択し、**「詳細設定...」**をクリックします。
  ![ターゲット](/images/Target.png) 
  
4. 「詳細設定」ウィンドウで、以下のようにします。
   - 「ローカル アダプター」フィールドと「イニシエーター IP」フィールドの値は、デフォルトのままにします。 iSCSI への複数のインターフェースを持つホスト・サーバーの場合、「イニシエーター IP」フィールドに適切な値を選択する必要があります。
   - **「ターゲット ポータル IP」**ドロップダウン・リストから、iSCSI ストレージの IP を選択します。
   - **「CHAP ログオンを有効にする」**チェック・ボックスをクリックします。
   - ポータルから取得した「名前」と「ターゲット シークレット」の値を入力し、**「OK」**をクリックします。
   - 「ターゲットへの接続」ウィンドウで**「OK」**をクリックして、「プロパティ」ウィンドウに戻ります。 「プロパティ」ウィンドウの「ID」ウィンドウ内に、複数のセッションが表示されるようになりました。 これで、iSCSI ストレージへの複数のセッションができました。
   ![設定](/images/Settings.png) 
   
5. 「プロパティ」ウィンドウで、**「デバイス」**をクリックし、「デバイス」ウィンドウを立ち上げます。 デバイス・インターフェース名は、デバイス名の先頭に mpio が付いています。 <br/>
  ![デバイス](/images/Devices.png) 
  
6. **「MPIO」**をクリックして、**「デバイスの詳細」**ウィンドウを立ち上げます。 このウィンドウで、MPIO のロード・バランシング・ポリシーを選択でき、iSCSI へのパスが表示されます。この例では、MPIO で使用可能な 2 つのパスと、「サブセットのラウンド ロビン」ロード・バランシング・ポリシーが表示されています。
  ![「デバイスの詳細」ダイアログに、MPIO で使用可能な 2 つのパスと、「サブセットのラウンド ロビン」ロード・バランシング・ポリシーが表示されています。](/images/DeviceDetails.png) 
  
7. **「OK」**を数回クリックして、iSCSI イニシエーターを終了します。



## Windows オペレーティング・システムで MPIO が正しく構成されているかどうかを検証する方法

Windows MPIO が構成されているかどうかを検証するには、まず MPIO アドオンが使用可能であることを確認し、マシンを再始動します。

![Roles_Features_0](/images/Roles_Features_0.png)

リブートが完了し、Storage Device が追加されると、MPIO が構成済みで機能しているかどうかを検証できます。 これを行うには、ターゲットの**「デバイスの詳細」**を参照し、**「MPIO」**をクリックします。
![DeviceDetails_0](/images/DeviceDetails_0.png)

MPIO が正しく構成されていないと、ネットワーク障害が発生した場合や、{{site.data.keyword.BluSoftlayer_full}} チームが保守を実行するときに、ストレージ・デバイスが切断され、使用不可になります。MPIO では、そのようなイベントが発生しても追加の接続レベルが保証され、LUN への読み取り/書き込みがアクティブな状態で、確立済みセッションが保持されます。

## {{site.data.keyword.blockstorageshort}} ボリュームのアンマウント方法

以下は、MPIO iSCSI LUN から Windows ベースの {{site.data.keyword.Bluemix_short}} コンピューティング・インスタンスを切断するために必要なステップです。 この例は、Windows Server 2012 に基づいています。 その他の Windows バージョンの場合、OS ベンダーの資料に従って、ステップを調整してください。

### iSCSI イニシエーターを開始します。

1. **「ターゲット」**タブをクリックします。
2. 削除するターゲットを選択し、**「切断」**をクリックします。

### (オプション) 今後 iSCSI ターゲットにアクセスする必要がない場合は、以下のようにします。

1. iSCSI イニシエーターの**「探索」**をクリックします。
2. ストレージ・ボリュームに関連付けられたターゲット・ポータルを強調表示し、**「削除」**をクリックします。
